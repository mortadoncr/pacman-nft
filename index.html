<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pacman NFT</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      height: 100%;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #111;
      width: 100vw;
      height: 100vh;
    }
    #mobile-controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 10;
    }
    #mobile-controls button {
      width: 60px;
      height: 60px;
      font-size: 24px;
      border-radius: 50%;
      border: none;
      background: #ff0;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      color: #ff0;
      font-family: monospace;
      font-size: 20px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="score">Score: 0</div>
  <div id="mobile-controls">
    <button onclick="move('up')">⬆️</button>
    <button onclick="move('left')">⬅️</button>
    <button onclick="move('down')">⬇️</button>
    <button onclick="move('right')">➡️</button>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const tileSize = 40;

    const map = [
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],
      [1,2,1,1,1,1,2,1,1,2,1,2,1,1,2,1,1,1,2,1,1],
      [1,2,1,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,1],
      [1,2,1,2,1,1,1,1,1,2,1,2,1,1,1,1,2,1,1,2,1],
      [1,2,2,2,1,2,2,2,1,2,1,2,1,2,2,2,2,1,2,2,1],
      [1,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,1,1,2,1,1],
      [1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,1],
      [1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1],
      [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ];

    const player = {
      x: 1,
      y: 1,
      size: tileSize * 0.8,
      px: 1 * tileSize,
      py: 1 * tileSize,
      image: new Image()
    };
    player.image.src = "pacman.png";

    let currentDirection = null;
    let nextDirection = null;
    let score = 0;

    function canMoveTo(x, y) {
      if (y < 0 || y >= map.length || x < 0 || x >= map[0].length) return false;
      return map[y][x] !== 1;
    }

    function tryChangeDirection() {
      if (!nextDirection) return;
      let nx = player.x;
      let ny = player.y;
      switch (nextDirection) {
        case "up": ny -= 1; break;
        case "down": ny += 1; break;
        case "left": nx -= 1; break;
        case "right": nx += 1; break;
      }
      if (canMoveTo(nx, ny)) {
        currentDirection = nextDirection;
        nextDirection = null;
      }
    }

    function update() {
      tryChangeDirection();

      if (!currentDirection) return;

      const speed = 4;
      let dx = 0, dy = 0;
      switch (currentDirection) {
        case "up": dy = -speed; break;
        case "down": dy = speed; break;
        case "left": dx = -speed; break;
        case "right": dx = speed; break;
      }

      let newPx = player.px + dx;
      let newPy = player.py + dy;

      let checkX = player.x;
      let checkY = player.y;

      if (currentDirection === "left") {
        checkX = Math.floor(newPx / tileSize);
      } else if (currentDirection === "right") {
        checkX = Math.floor((newPx + player.size) / tileSize);
      } else if (currentDirection === "up") {
        checkY = Math.floor(newPy / tileSize);
      } else if (currentDirection === "down") {
        checkY = Math.floor((newPy + player.size) / tileSize);
      }

      if (!canMoveTo(checkX, checkY)) {
        return;
      }

      player.px = newPx;
      player.py = newPy;
      player.x = Math.floor((player.px + player.size / 2) / tileSize);
      player.y = Math.floor((player.py + player.size / 2) / tileSize);

      if (map[player.y][player.x] === 2) {
        map[player.y][player.x] = 0;
        score++;
        document.getElementById("score").textContent = "Score: " + score;
      }
    }

    function drawMap() {
      for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
          switch (map[y][x]) {
            case 1:
              ctx.fillStyle = "#2222cc";
              ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
              break;
            case 2:
              ctx.fillStyle = "#ff0";
              ctx.beginPath();
              ctx.arc(x * tileSize + tileSize / 2, y * tileSize + tileSize / 2, tileSize / 8, 0, 2 * Math.PI);
              ctx.fill();
              break;
            default:
              ctx.fillStyle = "#000";
              ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
              break;
          }
        }
      }
    }

    function drawPlayer() {
      ctx.drawImage(player.image, player.px, player.py, player.size, player.size);
    }

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      update();
      drawMap();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    loop();

    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowUp": nextDirection = "up"; break;
        case "ArrowDown": nextDirection = "down"; break;
        case "ArrowLeft": nextDirection = "left"; break;
        case "ArrowRight": nextDirection = "right"; break;
      }
    });

    function move(dir) {
      nextDirection = dir;
    }
  </script>
</body>
</html>
