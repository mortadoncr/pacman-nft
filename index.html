<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pacman simple</title>
<style>
  body {
    background: #000;
    display: flex;
    justify-content: center;
    margin-top: 40px;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(20, 30px);
    grid-template-rows: repeat(20, 30px);
    gap: 2px;
    background: #111;
    border: 4px solid #222;
  }
  .cell {
    width: 30px;
    height: 30px;
    box-sizing: border-box;
  }
  .wall {
    background: #223;
  }
  .dot {
    background: #111;
    position: relative;
  }
  .dot::after {
    content: '';
    position: absolute;
    top: 12px;
    left: 12px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: yellow;
  }
  .pacman {
    background: yellow;
    border-radius: 50%;
    position: relative;
  }
  .pacman::before {
    content: '';
    position: absolute;
    top: 7px;
    left: 15px;
    width: 0; 
    height: 0; 
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-left: 15px solid black;
  }
  .ghost {
    background: red;
    border-radius: 50% 50% 0 0;
    position: relative;
    box-shadow: 0 6px 0 0 white, 8px 6px 0 0 white;
  }
  .ghost.blue {
    background: blue;
  }
</style>
</head>
<body>

<div id="game"></div>

<script>
  const width = 20;
  const height = 20;
  const game = document.getElementById('game');
  let grid = [];
  
  // Carte simple : 0 = sol avec point, 1 = mur
  // Créons une carte carrée avec murs autour
  let map = [];
  for(let i=0; i<height; i++) {
    let row = [];
    for(let j=0; j<width; j++) {
      if(i === 0 || i === height-1 || j === 0 || j === width-1) {
        row.push(1);
      } else {
        row.push(0);
      }
    }
    map.push(row);
  }
  
  // Ajouter quelques murs internes aléatoires
  for(let i=2; i<height-2; i+=3) {
    for(let j=2; j<width-2; j+=4) {
      map[i][j] = 1;
    }
  }

  // Initialisation affichage grille
  function createGrid() {
    game.innerHTML = '';
    grid = [];
    for(let i=0; i<height; i++) {
      for(let j=0; j<width; j++) {
        let cell = document.createElement('div');
        cell.classList.add('cell');
        if(map[i][j] === 1) cell.classList.add('wall');
        else if(map[i][j] === 0) cell.classList.add('dot');
        game.appendChild(cell);
        grid.push(cell);
      }
    }
  }
  
  // Positions de Pacman et fantômes
  let pacman = {x:1, y:1};
  let ghosts = [
    {x: width-2, y:1, color:'red'},
    {x: 1, y: height-2, color:'blue'}
  ];
  
  // Fonction pour convertir coord 2D en index 1D
  function posToIndex(x,y) {
    return y * width + x;
  }
  
  // Affiche Pacman et fantômes
  function drawCharacters() {
    // Clear previous
    grid.forEach(cell => {
      cell.classList.remove('pacman', 'ghost', 'blue');
    });
    // Pacman
    grid[posToIndex(pacman.x, pacman.y)].classList.add('pacman');
    // Fantômes
    ghosts.forEach(g => {
      let cls = 'ghost';
      if(g.color === 'blue') cls += ' blue';
      grid[posToIndex(g.x, g.y)].classList.add(...cls.split(' '));
    });
  }
  
  // Gestion déplacement Pacman
  window.addEventListener('keydown', e => {
    let newX = pacman.x;
    let newY = pacman.y;
    if(e.key === 'ArrowUp') newY--;
    else if(e.key === 'ArrowDown') newY++;
    else if(e.key === 'ArrowLeft') newX--;
    else if(e.key === 'ArrowRight') newX++;
    
    if(map[newY] && map[newY][newX] === 0) {
      pacman.x = newX;
      pacman.y = newY;
      // Manger point
      map[newY][newX] = 2; // 2 = vide
      updateGridDot(newX, newY);
    }
    drawCharacters();
  });
  
  // Supprimer point après manger
  function updateGridDot(x,y) {
    let cell = grid[posToIndex(x,y)];
    cell.classList.remove('dot');
  }
  
  // Mouvement fantômes simple aléatoire
  function moveGhosts() {
    ghosts.forEach(g => {
      const directions = [
        {x: 0, y:-1},
        {x: 0, y: 1},
        {x:-1, y: 0},
        {x: 1, y: 0},
      ];
      let possibleMoves = directions.filter(d => {
        let nx = g.x + d.x;
        let ny = g.y + d.y;
        return map[ny] && map[ny][nx] !== 1;
      });
      if(possibleMoves.length > 0) {
        let move = possibleMoves[Math.floor(Math.random()*possibleMoves.length)];
        g.x += move.x;
        g.y += move.y;
      }
    });
  }
  
  // Vérifie collision Pacman et fantômes
  function checkCollision() {
    for(let g of ghosts) {
      if(g.x === pacman.x && g.y === pacman.y) {
        alert('Game Over !');
        resetGame();
        break;
      }
    }
  }
  
  // Reset
  function resetGame() {
    pacman = {x:1, y:1};
    ghosts = [
      {x: width-2, y:1, color:'red'},
      {x: 1, y: height-2, color:'blue'}
    ];
    // Reset map points
    for(let i=1; i<height-1; i++) {
      for(let j=1; j<width-1; j++) {
        if(map[i][j] !== 1) map[i][j] = 0;
      }
    }
    createGrid();
    drawCharacters();
  }
  
  // Game loop fantômes + collision
  function gameLoop() {
    moveGhosts();
    drawCharacters();
    checkCollision();
  }
  
  // Initialisation
  createGrid();
  drawCharacters();
  setInterval(gameLoop, 500);
</script>

</body>
</html>
